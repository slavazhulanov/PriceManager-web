# API для PriceManager на Vercel

## Обзор

В этой директории находится код, который работает на платформе Vercel и обеспечивает базовую функциональность API для приложения PriceManager.

## Особенности реализации

1. **Serverless функции**: Код в `index.py` работает как serverless функция, обрабатывая HTTP запросы.
2. **Заглушки API**: Поскольку на Vercel нет полноценного бэкенда, этот код предоставляет заглушки основных API-методов.
3. **Отладочные данные**: Реализована выдача тестовых данных для тестирования фронтенда без реального бэкенда.

## Обработка запросов

Файл `index.py` обрабатывает следующие запросы:

1. **GET /api/v1/files/columns/{filename}** - Возвращает тестовые колонки для файлов
   - Для файлов поставщика: `["Артикул", "Наименование", "Цена", "Остаток", "Код производителя"]`
   - Для файлов магазина: `["Артикул", "Наименование", "Цена", "Количество"]`

2. **POST /api/v1/files/upload_url** - Возвращает URL для загрузки файла

3. **POST /api/v1/files/register** - Регистрирует загруженный файл

4. **POST /api/v1/comparison/compare** - Возвращает тестовый результат сравнения файлов

## Отладка

Для отладки API на Vercel:

1. Проверьте логи функции в консоли Vercel
2. Используйте `print()` для вывода отладочной информации в логи
3. Если API возвращает неожиданные данные, проверьте соответствующие обработчики в `index.py`

## Обновление API

При добавлении новых функций в основной бэкенд, необходимо также обновить этот файл:

1. Добавьте обработку новых путей в `index.py`
2. Реализуйте тестовые данные для новых методов API
3. Обновите маршрутизацию в `vercel.json` если потребуется

## Важные замечания

1. Этот код предназначен только для минимальной поддержки демонстрационной версии на Vercel
2. Для полной функциональности используйте локальный бэкенд
3. Всегда синхронизируйте изменения основного бэкенда с этим API, чтобы избежать несовместимости

## Проблемы и решения

### Пустой ответ при запросе колонок

**Проблема**: API возвращает `{"status":"ok","message":"API работает"}` вместо списка колонок

**Решение**: Добавлена специальная обработка запросов `/api/v1/files/columns/{filename}`, которая возвращает тестовые колонки.

### Маршрутизация на Vercel

**Проблема**: Не все API запросы правильно перенаправляются на функцию

**Решение**: Обновлен файл `vercel.json` с более точными правилами маршрутизации. 